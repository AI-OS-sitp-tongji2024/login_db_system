# 数据库说明文档


## 数据库表结构

### Users 表
| 字段名      | 类型          | 描述                                                         |
|-------------|---------------|--------------------------------------------------------------|
| user_id     | INTEGER       | 用户ID，主键，唯一，非空                                     |
| username    | TEXT          | 用户名，唯一，非空                                           |
| password    | TEXT          | 用户密码，非空                                               |
| created_at  | TEXT          | 用户创建时间，默认值为当前时间戳                             |

### Roles 表
| 字段名      | 类型          | 描述                                                         |
|-------------|---------------|--------------------------------------------------------------|
| name        | TEXT          | 角色名称，主键，唯一，非空                                   |

### Permission 表
| 字段名      | 类型          | 描述                                                         |
|-------------|---------------|--------------------------------------------------------------|
| operation   | TEXT          | 权限操作，主键，唯一，非空                                   |

### Rela_user_role 表
| 字段名      | 类型          | 描述                                                         |
|-------------|---------------|--------------------------------------------------------------|
| user_id     | INTEGER       | 用户ID，外键，关联 Users 表的 user_id 字段                   |
| role_name   | TEXT          | 角色名称，外键，关联 Roles 表的 name 字段                    |

### Rela_role_permission 表
| 字段名      | 类型          | 描述                                                         |
|-------------|---------------|--------------------------------------------------------------|
| role_name   | TEXT          | 角色名称，外键，关联 Roles 表的 name 字段                    |
| operation   | TEXT          | 权限操作，外键，关联 Permission 表的 operation 字段          |

### UserLogs 表
| 字段名      | 类型          | 描述                                                         |
|-------------|---------------|--------------------------------------------------------------|
| log_id      | INTEGER       | 日志ID，自增主键                                             |
| user_id     | INTEGER       | 用户ID，外键，关联 Users 表的 user_id 字段                   |
| action      | TEXT          | 用户操作，非空                                               |
| result      | TEXT          | 操作结果，非空                                               |
| timestamp   | TEXT          | 操作时间戳，默认值为当前时间戳                               |


## 数据库操作函数

### connectToDatabase()
- **功能**：创建数据库连接。
- **返回值**：数据库连接对象和错误信息。

### createTables(db)
- **功能**：创建所有数据库表。
- **参数**：数据库连接对象。
- **返回值**：错误信息。

### insertUser(db, userID, username, password)
- **功能**：插入用户并记录日志。
- **参数**：数据库连接对象、用户ID、用户名、密码。
- **返回值**：错误信息。

### DeleteUser(db, currentUserID, targetUserID)
- **功能**：删除用户。
- **参数**：数据库连接对象、当前用户ID、目标用户ID。
- **返回值**：错误信息。

### UpdateUserInfo(db, currentUserID, targetUserID, username, password)
- **功能**：修改用户信息。
- **参数**：数据库连接对象、当前用户ID、目标用户ID、用户名、密码。
- **返回值**：错误信息。

### ModifyRolePermissions(db, currentUserID, roleName, operations)
- **功能**：修改角色权限。
- **参数**：数据库连接对象、当前用户ID、角色名称、权限操作列表。
- **返回值**：错误信息。

### AssignUserRole(db, currentUserID, targetUserID, roleName)
- **功能**：赋予用户角色。
- **参数**：数据库连接对象、当前用户ID、目标用户ID、角色名称。
- **返回值**：错误信息。

### VerifyPassword(db, userID, password)
- **功能**：验证用户密码。
- **参数**：数据库连接对象、用户ID、密码。
- **返回值**：布尔值（验证结果）和错误信息。

### isAdmin(db, userID)
- **功能**：检查用户是否为高级管理员。
- **参数**：数据库连接对象、用户ID。
- **返回值**：布尔值（是否为管理员）和错误信息。

### getUserRole(db, userID)
- **功能**：获取用户角色。
- **参数**：数据库连接对象、用户ID。
- **返回值**：用户角色名称和错误信息。

### QueryUserPermissions(db, userID)
- **功能**：查询用户权限。
- **参数**：数据库连接对象、用户ID。
- **返回值**：用户权限列表和错误信息。

### insertTestData(db)
- **功能**：插入测试数据。
- **参数**：数据库连接对象。
- **返回值**：错误信息。
